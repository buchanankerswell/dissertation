% This is a combination of pandoc's default latex template:
% https://github.com/jgm/pandoc/blob/master/data/templates/default.latex
%
% and Dylan Mikesell's BSU thesis template:
% https://github.com/dylanmikesell/BSU_LaTeX_Thesis_Template/blob/master/src/BSUmain.tex
%
% and Dylan Mikesell's BSU style file:
% https://github.com/dylanmikesell/BSU_LaTeX_Thesis_Template/blob/master/src/BSUthesis.sty

% For BSU style requirements see:
% https://github.com/dylanmikesell/BSU_LaTeX_Thesis_Template/blob/master/src/BSU_checklist.pdf

% For pandoc YAML options see:
% https://pandoc.org/MANUAL.html#variables-for-latex

% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode$for(hyperrefoptions)$,$hyperrefoptions$$endfor$}{hyperref}
\PassOptionsToPackage{hyphens}{url}
$if(colorlinks)$
  \PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
$endif$

% Document class options
\documentclass[
  $if(fontsize)$
    $fontsize$,
  $endif$
  $if(lang)$
    $babel-lang$,
  $endif$
  $if(papersize)$
    $papersize$paper,
  $endif$
  $for(classoption)$
    $classoption$$sep$,
  $endfor$
]{$documentclass$}

% Math packages
\usepackage{amsmath,amssymb}

% Textcase for handling upper/lower case
\usepackage{textcase}

% Changepage package for changing layout in the middle of a document
\usepackage{changepage}

% Abbreviations and acronyms
\usepackage[automake,nonumberlist,acronyms]{glossaries-extra}

% Nomenclature
\usepackage[noprefix,intoc]{nomencl}

% For month year format
\usepackage{datetime}

% For chapter (and other) headings required by BSU
\usepackage{fancyhdr}

% Set captions to bold
\usepackage[labelfont=bf,textfont=bf]{caption}

% Font family setting
$if(fontfamily)$
  \usepackage[$for(fontfamilyoptions)$$fontfamilyoptions$$sep$,$endfor$]{$fontfamily$}
$else$
  % Default to adobe times new roman with math support
  \usepackage{mathptmx}
$endif$

% Linespacing using setspace package
$if(linestretch)$
  \usepackage{setspace}
  \setstretch{$linestretch$}
$endif$

% Font encoding
% Defaults to 8-bit T1 encoding with 256 glyphs
% https://ctan.org/pkg/encguide
% http://www.micropress-inc.com/fonts/encoding/t1.htm
\usepackage[$if(fontenc)$$fontenc$$else$T1$endif$]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{textcomp} % provide euro and other symbols

% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[$for(microtypeoptions)$$microtypeoptions$$sep$,$endfor$]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}

% Some options for URLs
\usepackage{xcolor} % Handles colors
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\urlstyle{same} % disable monospaced font for URLs

% Creates metadata and handles some hyperlink options
\hypersetup{
  $if(title-meta)$
    pdftitle={$title-meta$},
  $endif$
  $if(author-meta)$
    pdfauthor={$author-meta$},
  $endif$
  $if(lang)$
    pdflang={$lang$},
  $endif$
  $if(subject)$
    pdfsubject={$subject$},
  $endif$
  $if(keywords)$
    pdfkeywords={$for(keywords)$$keywords$$sep$, $endfor$},
  $endif$
  $if(colorlinks)$
    colorlinks=true,
    linkcolor={$if(linkcolor)$$linkcolor$$else$Maroon$endif$},
    filecolor={$if(filecolor)$$filecolor$$else$Maroon$endif$},
    citecolor={$if(citecolor)$$citecolor$$else$Blue$endif$},
    urlcolor={$if(urlcolor)$$urlcolor$$else$Blue$endif$},
  $else$
    hidelinks,
  $endif$
    pdfcreator={LaTeX via pandoc}
}

$if(geometry)$
  \usepackage[$for(geometry)$$geometry$$sep$,$endfor$]{geometry}
$endif$

% Handles code blocks
$if(listings)$
  \usepackage{listings}
  \newcommand{\passthrough}[1]{#1}
  \lstset{defaultdialect=[5.3]Lua}
  \lstset{defaultdialect=[x86masm]Assembler}
$endif$

% Tables settings
$if(tables)$
  \usepackage{longtable,booktabs,array}
  $if(multirow)$
    \usepackage{multirow}
  $endif$
  \usepackage{calc} % for calculating minipage widths
  % Correct order of tables after \paragraph or \subparagraph
  \usepackage{etoolbox}
  \makeatletter
  \patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
  \makeatother
  % Allow footnotes in longtable head/foot
  \IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
  \makesavenoteenv{longtable}
$endif$

$if(graphics)$
  \usepackage{graphicx}
  \makeatletter
  \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
  \def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
  \makeatother
  % Scale images if necessary, so that they will not overflow the page
  % margins by default, and it is still possible to overwrite the defaults
  % using explicit options in \includegraphics[width, height, ...]{}
  \setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
  % Set default figure placement to htbp
  \makeatletter
  \def\fps@figure{htbp}
  \makeatother
$endif$

$if(links-as-notes)$
  % Make links footnotes instead of hotlinks:
  \DeclareRobustCommand{\href}[2]{#2\footnote{\url{#1}}}
$endif$

% Handles verbatim text in footnotes
$if(verbatim-in-note)$
  \usepackage{fancyvrb}
$endif$
% allow verbatim text in footnotes
$if(verbatim-in-note)$
  \VerbatimFootnotes
$endif$

% Strikeout and underline text
$if(strikeout)$
  % also used for underline
  \usepackage[normalem]{ulem}
  % Avoid problems with \sout in headers with hyperref
  \pdfstringdefDisableCommands{\renewcommand{\sout}{}}
$endif$

% Prevent overfull lines
\setlength{\emergencystretch}{3em}
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% Numbered sections settings
$if(numbersections)$
  \setcounter{secnumdepth}{$if(secnumdepth)$$secnumdepth$$else$5$endif$}
$else$
  \setcounter{secnumdepth}{-\maxdimen} % remove section numbering
$endif$

% Block headings settings
$if(block-headings)$
  % Make \paragraph and \subparagraph free-standing
  \ifx\paragraph\undefined\else
    \let\oldparagraph\paragraph
    \renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
  \fi
  \ifx\subparagraph\undefined\else
    \let\oldsubparagraph\subparagraph
    \renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
  \fi
$endif$

% Page style settings
$if(pagestyle)$
  \pagestyle{$pagestyle$}
$endif$

% Citation style (csl) settings
$if(csl-refs)$
  \newlength{\cslhangindent}
  \setlength{\cslhangindent}{1.5em}
  \newlength{\csllabelwidth}
  \setlength{\csllabelwidth}{3em}
  \newlength{\cslentryspacingunit} % times entry-spacing
  \setlength{\cslentryspacingunit}{\parskip}
  \newenvironment{CSLReferences}[2] % #1 hanging-ident, #2 entry spacing
   {% don't indent paragraphs
    \setlength{\parindent}{0pt}
    % turn on hanging indent if param 1 is 1
    \ifodd #1
    \let\oldpar\par
    \def\par{\hangindent=\cslhangindent\oldpar}
    \fi
    % set entry spacing
    \setlength{\parskip}{#2\cslentryspacingunit}
   }%
   {}
  \usepackage{calc}
  \newcommand{\CSLBlock}[1]{#1\hfill\break}
  \newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{#1}}
  \newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{#1}\break}
  \newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}
$endif$

% Expand header includes
$for(header-includes)$
  $header-includes$
$endfor$

% Language settings
$if(lang)$
  \usepackage[$for(babel-otherlangs)$$babel-otherlangs$,$endfor$main=$babel-lang$]{babel}
  % get rid of language-specific shorthands (see #6817):
  \let\LanguageShortHands\languageshorthands
  \def\languageshorthands#1{}
$endif$

% Bibliography settings
% Natbib settings
$if(natbib)$
  \usepackage[$natbiboptions$]{natbib}
  \bibliographystyle{$if(biblio-style)$$biblio-style$$else$plainnat$endif$}
$endif$

% Nocite
$if(nocite-ids)$
  \nocite{$for(nocite-ids)$$it$$sep$, $endfor$}
$endif$

% Cs quotes
$if(csquotes)$
  \usepackage{csquotes}
$endif$

% Setting definitions to make specific pages and layouts for BSU dissertation

% Set section title formatting and first paragraph spacing
\usepackage{titlesec}

% Section
\titlespacing*{\section}{0pt}{0em}{0pt}{}
\titleformat{\section}[hang]
  {\normalfont\Large\bfseries\centering}
  {\thetitle}
  {1em}
  {}

% Subsection
\titlespacing*{\subsection}{0pt}{0em}{0pt}{}
\titleformat{\subsection}[hang]
  {\normalfont\large\bfseries}
  {\thetitle}
  {1em}
  {}

% Final reading page definitions
\usepackage{tabularx}

% Make title page
\def\maketitle{
  \cleardoublepage
  \begin{titlepage}
    \pagenumbering{roman}
    \begin{center}
      \vspace*{0.1in}
        {\large \MakeUppercase{$title$} \par}
        \vfill

        {by\\}
        {$author$}
        \vfill

        A dissertation\\
        submitted in partial fulfillment \\
        of the requirements for the degree of\\
        $degree$~in~$discipline$\\
        Boise State University
        \vspace*{0.5in}

        $date$
    \end{center}\par
  \end{titlepage}
  \let\maketitle\relax
}

% Make final reading approval form
\def\makesubmittalsheet{
  \cleardoublepage 
  \begin{center}
  BOISE STATE UNIVERSITY GRADUATE COLLEGE\\
  \vspace{\baselineskip}
  \textbf{DEFENSE COMMITTEE AND FINAL READING APPROVALS}\\
  \vspace{\baselineskip}
  of the dissertation submitted by\\
  \vspace{\baselineskip}
  {$author$}\\
  \vspace{\baselineskip}
  \end{center}
  \begin{flushleft}
    \begin{singlespace}
      \begin{tabularx}{\textwidth}{@{}lX} 
        Dissertation Title: & {$title$}
      \end{tabularx}
    \end{singlespace}
    \begin{tabularx}{\textwidth}{@{}lX} 
      Date of Final Oral Examination: & {$oralexamdate$}
    \end{tabularx}
  \end{flushleft}
  \begin{singlespace}
    \noindent The following individuals read and discussed the dissertation submitted by student {$author$}, and they evaluated the studentâ€™s presentation and response to questions during the final oral examination. They found that the student passed the final oral examination.\\
  \end{singlespace}
  \begin{flushleft}
    \begin{tabular}{@{}ll} 
      {$advisor.name$} {$advisor.title$} \hspace{2cm} & {$advisor.function$} \\ 
      {$committeeMemberA.name$} {$committeeMemberA.title$} \hspace{2cm} & {$committeeMemberA.function$} \\ 
      {$committeeMemberB.name$} {$committeeMemberB.title$} \hspace{2cm} & {$committeeMemberB.function$} \\
      {$externalMember.name$} {$externalMember.title$} \hspace{2cm} & {$externalMember.function$}
    \end{tabular}
  \end{flushleft}
  \begin{singlespace}
    \noindent The final reading approval of the dissertation was granted by {$advisor.name$} {$advisor.title$}, Chair of the Supervisory Committee. The dissertation was approved by the Graduate College.
  \end{singlespace}
  \thispagestyle{empty}
  \par\vfil\null\newpage
  \let\makesubmittalsheet\relax
}

% Make copyright page
\def\makecopyright{
  \null
  \vfill
  \begin{center}
    {$$\copyright$$ \number\year \par $author$}\\
    {\sc ALL RIGHTS RESERVED}
  \end{center}
  \thispagestyle{empty}
  \let\maketitle\relax\let\makecopyright\relax
}

% Reset some settings before main body
\def\begintext{
  \cleardoublepage
  \setcounter{page}{1}
  \pagenumbering{arabic}
  \pagestyle{myheadings}
    % For the special first page of a chapter:
    \fancypagestyle{plain}{
    \fancyhf{}
    \fancyhead[RO]{\hfill \thepage}
    \renewcommand\headrulewidth{0pt}
    \renewcommand\footrulewidth{0pt}
    \renewcommand\headsep{0pt}
    \renewcommand\footskip{4.5pt}
    }
}

% Table of contents style
\makeatletter
\renewcommand\contentsname{table of contents}
\renewcommand*\l@chapter[2]{
  \ifnum \c@tocdepth >\m@ne
    \addpenalty{-\@highpenalty}
    \vskip 1.0em \@plus\p@
    \setlength\@tempdima{1.5em}
    \begingroup
      \parindent \z@ \rightskip \@pnumwidth
      \parfillskip -\@pnumwidth
      \leavevmode 
      \advance\leftskip\@tempdima
      \hskip -\leftskip
      \uppercase{#1}\nobreak 
      \leaders\hbox{$$\m@th
      \mkern \@dotsep mu\hbox{.}\mkern \@dotsep
      mu$$}\hfil\nobreak\hb@xt@\@pnumwidth{\hss #2}\par
      \penalty\@highpenalty
    \endgroup
  \fi
} 
\makeatother

% Chapter headings
\makeatletter
\def\@makechapterhead#1{
  \vspace*{50\p@}
  {
    \parindent \z@ \raggedright \normalfont
    \ifnum \c@secnumdepth >\m@ne
      % colon here fixes as well as upper case
      \centering \Large\bfseries\MakeUppercase \@chapapp{}\space \thechapter :
      \par\nobreak
    \fi
    \interlinepenalty\@M
    % makeuppercase here sets the actual uppercase
    \Large\bfseries \MakeUppercase{#1}\par\nobreak
    \vskip 12\p@
  }
}

% Chapter* headings
\def\@makeschapterhead#1{
  \vspace*{50\p@}
  {
    \parindent \z@ \raggedright
    \normalfont
    \interlinepenalty\@M
    % uppercase here and set \Large to match
    \centering \Large \bfseries \MakeUppercase{#1}\par\nobreak
    \vskip 12\p@
  }
}
\makeatother

% For abbreviations
\makeglossaries
\loadglsentries{abbreviations}

% For symbols and nomenclature 
\makenomenclature
\input{nomenclature}

$if(title)$
  \title{$title$}
$endif$

% Define document layout

\begin{document}

% Define a bunch of fields for makeing the title page,
% copyright page, and final approval page
$if(author)$
  \author{$author$}
$endif$

% Title page
$if(title)$
  \maketitle
$endif$

% Copyright page
$if(copyright)$
  \makecopyright
$endif$

% Final approval page
$if(approval)$
  \makesubmittalsheet
$endif$

\setcounter{page}{4}

% Other front matter before body
% Dedication
$if(dedication)$
  \chapter*{Dedication}
  \addcontentsline{toc}{chapter}{Dedication}
  $dedication$
$endif$

% Acknowledments
$if(acknowledgment)$
  \chapter*{Acknowledgment}
  \addcontentsline{toc}{chapter}{Acknowledgment}
  $acknowledgment$
$endif$

% Autobiographic sketch (optional)
$if(autobiographics)$
  \chapter*{Autobiographical sketch}
  \addcontentsline{toc}{chapter}{Autobiographical sketch}
  $autobiographics$
$endif$

% Abstract
$if(abstract)$
  \chapter*{Abstract}
  \addcontentsline{toc}{chapter}{Abstract}
  $abstract$
$endif$

% Table of contents
$if(toc)$
  \tableofcontents
$endif$

% List of figures
$if(lof)$
  \cleardoublepage
  \addcontentsline{toc}{chapter}{List of figures}
  \listoffigures
$endif$

% List of tables
$if(lot)$
  \cleardoublepage
  \addcontentsline{toc}{chapter}{List of tables}
  \listoftables
$endif$

% List of abbreviations
$if(glossary)$
  \printglossary[title={List of abbreviations},type=\acronymtype]
$endif$

% List of symbols
$if(symbols)$
  \cleardoublepage
  \addcontentsline{toc}{chapter}{List of symbols} 
  \renewcommand{\nomname}{List of symbols}
  \markboth{\nomname}{\nomname}
  \printnomenclature
$endif$

% Reset settings before body
\begintext

% Body (everything in .Rmd beneath YAML)
$body$

% Bibliography
$if(natbib)$
  $if(bibliography)$
    $if(biblio-title)$
      \renewcommand\bibname{$biblio-title$}
    $endif$
  \cleardoublepage
  \addcontentsline{toc}{chapter}{References}
  \bibliography{$for(bibliography)$$bibliography$$sep$,$endfor$}
  $endif$
$endif$

\end{document}